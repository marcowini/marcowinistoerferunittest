package com.mayab.quality.integration;

// Necessary imports...

class UserServiceTest extends DBTestCase {

    public UserServiceTest() {
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_DRIVER_CLASS, "com.mysql.cj.jdbc.Driver");
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_CONNECTION_URL, "jdbc:mysql://localhost:3306/calidad2024");
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_USERNAME, "root");
        System.setProperty(PropertiesBasedJdbcDatabaseTester.DBUNIT_PASSWORD, "root");
    }

    private IDAOUser dao;
    private UserService service;

    @BeforeEach
    protected void setup() throws Exception {
        dao = new UserMySqlDao();
        service = new UserService(dao);

        IDatabaseConnection connection = getConnection();
        try {
            DatabaseOperation.TRUNCATE_TABLE.execute(connection, getDataSet());
            DatabaseOperation.CLEAN_INSERT.execute(connection, getDataSet());
        } finally {
            connection.close();
        }
    }

    protected IDataSet getDataSet() throws Exception {
        return new FlatXmlDataSetBuilder().build(new FileInputStream("src/resources/initDB.xml"));
    }

    @Test
    public void testCreateUser_HappyPath() {
        User user = new User("hola", "hola@gmail.com", "pass1234");
        User createdUser = service.createUser("hola", "hola@gmail.com", "pass1234");
        assertNotNull(createdUser);
        assertEquals("hola", createdUser.getName());
    }

    // Other tests omitted for brevity...
}
